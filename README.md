# Resilient NestJS Architecture

A fault-tolerant NestJS backend demonstrating safe retries, fallback cache, circuit breaking, message-queue-based write-path recovery, and full observability via OpenTelemetry, Jaeger, Prometheus, and Grafana.  

Detailed description: https://medium.com/@dmytro_kostenko/resilient-backend-architecture-from-implementation-to-chaos-testing-2e98269fa346

## Setup

- Requirements: Node 20+, npm 10+, Docker + Docker Compose.  
- Environment: all variables are defined in `.env.*.dist`. Missing files are auto-generated by the run scripts.  
- Install dependencies: `npm install`.

## Running

- **Full stack** (API, worker, dependencies, telemetry):  
  `npm run compose`  
  Uses `.env.core` and `.env.overlay`.

- **Local development** with Dockerized dependencies:  
  `npm run compose:local`  
  Then run API and worker locally:  
  `npm run start:api:local`  
  `npm run start:worker:local`  
  Uses `.env.core` and `.env.overlay.local`.

### Access

- API — `${APP_PORT}` (default http://localhost:9000)  
- Grafana — `${GF_PORT}` (default http://localhost:3000)  
- Jaeger — `${JAEGER_PORT}` (default http://localhost:16686)  
- Prometheus — `${PROMETHEUS_PORT}` (default http://localhost:9090)

## Testing

- Unit, integration, and e2e test suites are not implemented.  
- Load testing: `npm run k6`.  
- Chaos testing: `npm run chaos -- -n <scenario>` (runs Toxiproxy scenarios in `test/chaos/run.sh`).

## Architecture

See `docs/diagrams` for PNG and PlantUML diagrams covering:

- Architecture
- Safe retries
- Fallback Cache
- Message Queue (sync write-path fallback, async processing, client flow)
- Circuit breaker

The architecture is fully adapter-driven: database and cache implementations can be swapped without touching application logic.  
Current adapters include:

- Databases: PostgreSQL, MongoDB, and an in-memory repository  
- Cache: Redis and an in-memory cache

## TODO

- Add unit, integration, and e2e coverage.  
- Harden idempotency around circuit-breaker timeouts to avoid duplicate worker execution.  
- Add per-endpoint API documentation.

## License

MIT — see `LICENSE`.
